/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2024 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */


#include <stdint.h>

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

void delay(int x);

int main(void)
{
	uint32_t * pC1kcrtlreg = (uint32_t*)0x40023830; // Register of the RCC for APB2STR related to PORTC
	uint32_t * pPortDModeReg = (uint32_t*)0x40020400; // Enable the port Register - high register because PIN13
	uint32_t * pPortDOutReg = (uint32_t*)0x40020414; // Register for the OUTPUT Pins

	/*
	 * NOTE: the declaration and initilization of the pointers above, is as follows:
	 * The unit32_t * ptr is the declaration
	 * The initilization ocurrs with (unit32_t*)x which typecasts that tells the compiler to treat the x as a 32 bit integer pointer,
	 * therefore giving out recently declared pointer the address of our given address (pointer) to it. now this is inverse pointer, where
	 * we give it an address to keep follow and change, to dereference now we use & (reference operator) and to reference we use * (deferecnce op)
	 * This makes handling Register easier and intuitive.
	 * https://medium.com/@shathiralakdilu/pointers-in-embedded-c-a7afa851c84a#:~:text=Pointers%20play%20a%20crucial%20role%20in%20memory%20management%2C%20serving%20as,facilitating%20more%20efficient%20data%20handling.
	 */

	// Enable the Clock for the GPIOD peripheral in the AHB1ENR
	//*pC1kcrtlreg |= (1<<4); // Here we use a 1-Bit shiffted to the left to set the 4th Bit in the register which correponds with IOPC EN
	*pC1kcrtlreg |= 0x00000002;
	// Configure the Mode of the PIN (output)
	//*pPortDModeReg &= 0xff0fffff;
	//*pPortDModeReg |= (1<<21); // Set as output max speed 2Mhz
	*pPortDModeReg |= 0x00000001;
	//*pPortDModeReg &= ~(1<<22); // Quit the reset state of the PC13 and put it in push pull.


	// TURN ON

    /* Loop forever */
	while(1){
		//pPortDOutReg |= (1<<13); //Equivalent
		*pPortDOutReg |= 0x00000001;
		delay(100000);
		//*pPortDOutReg &= ~(1<<13); //Equivalent
		*pPortDOutReg &= ~0x00000001;
		delay(100000);
	}
}

void delay (int x) // Delay function using volatile int (not optimize Assembly code)
{
  volatile int i,j;
  for (i=0 ; i < x ; i++)
  {
     j++;
  }
  return;
}
